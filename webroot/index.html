<!DOCTYPE html>
<html lang="en">
<head>
<title>WebSocket Chat Test</title>
<script language="javascript" type="text/javascript">
    var wsUri = "ws://"+ location.host+"/ws";
    var httpURI = "http://"+location.host+"/";
	var output, input, send;
	var ws_params = {"channel":"trial1"};
	
	function init() {
		output = document.getElementById("output");
		input = document.getElementById("input");
        requestJoin();
		
	}
    function requestJoin() {
    		connectWebsocket(ws_params.channel);
  
    }
               
	function connectWebsocket(channel, clientid) {
		websocket = new WebSocket(wsUri);
		websocket.onopen = function(evt) { onOpen(evt) };
		websocket.onclose = function(evt) { onClose(evt) };
		websocket.onmessage = function(evt) { onMessage(evt) };
		websocket.onerror = function(evt) { onError(evt) };
	}

	function onOpen(evt) {
		if(ws_params.client_id == undefined){
			writeToScreen("Connecting: "+evt.data);
			valuetosend = {"cmd": "register", "msg": "joining channel "+ws_params.channel, "channelid":ws_params.channel};
        
		} else {
			writeToScreen("CONNECTED: "+evt.data);
			valuetosend = {"cmd": "register", "msg": "registered "+ws_params.client_id, "clientid": ws_params.client_id, "channelid": ws_params.channel_id};
        
		}
		websocket.send(JSON.stringify(valuetosend));
        
        writeToScreen('<span style="color: red;">Registering:<\/span> ');
	}

	function onClose(evt) {
		writeToScreen("DISCONNECTED");
	}

	function onMessage(evt) {
		json_data = JSON.parse(evt.data);
		msg = json_data["msg"];
		request = json_data["request"];
		
		writeToScreen('<span style="color: blue;">RESPONSE: ' + msg+' for Request: '+ request +'<\/span>');
	}

	function onError(evt) {
		writeToScreen('<span style="color: red;">ERROR:<\/span> ' + evt.data);
	}

	function doSend() {
		writeToScreen('<span style="color: red;">SENDING:<\/span> ' + input.value);
        valuetosend = {"cmd": "send", "msg": input.value, "clientid": ws_params.client_id, "channelid": ws_params.channel_id};
        websocket.send(JSON.stringify(valuetosend));
	}

    function doEcho() {
        writeToScreen('<span style="color: red;">Echo:<\/span> ' + input.value);
        valuetosend = {"cmd": "echo", "msg": input.value, "clientid": ws_params.client_id, "channelid": ws_params.channel_id};
        websocket.send(JSON.stringify(valuetosend));
    }
	function writeToScreen(message) {
		output.innerHTML += '<br>' +message
	}

	window.addEventListener("load", init, false);
</script>
</head>

<body>
<h2>PerfectChat Server Example</h2>
<p>Chat Server joined on load. Press send to broadcast to others, echo to bounce a message off the Server</p>
<div id = "left_side" style="float: left;">
    <textarea id="input" cols=48 rows=28 >Sample Text</textarea>
    <br>
    <button onclick="doSend()">Send</button><button onclick="doEcho()">Echo</button>

</div>
<div id="right_side" style="float: left;width:250px;overflow:scroll">
    <div id="output"></div>
</div>
</body>
<script src="https://code.jquery.com/jquery-2.2.0.min.js" ></script>
</html>
