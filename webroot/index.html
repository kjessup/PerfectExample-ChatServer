<!DOCTYPE html>
<html lang="en">
<head>
<title>WebSocket Echo Test</title>
<script language="javascript" type="text/javascript">
    var wsUri = "ws://"+ location.host+"/ws";
    wsUri = "ws://0.0.0.0:8181/ws";
    var httpURI = "http://"+location.host+"/";
	var output, input, send;
	ws_params = {"channel":"trial1"};
	
	function init() {
		output = document.getElementById("output");
		input = document.getElementById("input");
        requestJoin();
		
	}
    function requestJoin() {
    		testWebSocket(ws_params.channel);
  
    }
               
	function testWebSocket(channel, clientid) {
		websocket = new WebSocket(wsUri);
		websocket.onopen = function(evt) { onOpen(evt) };
		websocket.onclose = function(evt) { onClose(evt) };
		websocket.onmessage = function(evt) { onMessage(evt) };
		websocket.onerror = function(evt) { onError(evt) };
	}

	function onOpen(evt) {
		if(ws_params.client_id == undefined){
			writeToScreen("Connecting: "+evt.data);
			valuetosend = {"cmd": "register", "msg": "joining channel "+ws_params.channel, "channelid":ws_params.channel};
        
		} else {
			writeToScreen("CONNECTED: "+evt.data);
			valuetosend = {"cmd": "register", "msg": "registered "+ws_params.client_id, "clientid": ws_params.client_id, "channelid": ws_params.channel_id};
        
		}
		websocket.send(JSON.stringify(valuetosend));
        
        writeToScreen('<span style="color: red;">Registering:<\/span> ');
	}

	function onClose(evt) {
		writeToScreen("DISCONNECTED");
	}

	function onMessage(evt) {
		writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'<\/span>');
	}

	function onError(evt) {
		writeToScreen('<span style="color: red;">ERROR:<\/span> ' + evt.data);
	}

	function doSend() {
		writeToScreen('<span style="color: red;">SENDING:<\/span> ' + input.value);
        valuetosend = {"cmd": "send", "msg": input.value, "clientid": ws_params.client_id, "channelid": ws_params.channel_id};
        websocket.send(JSON.stringify(valuetosend));
	}

    function doEcho() {
        writeToScreen('<span style="color: red;">Echo:<\/span> ' + input.value);
        valuetosend = {"cmd": "echo", "msg": input.value, "clientid": ws_params.client_id, "channelid": ws_params.channel_id};
        websocket.send(JSON.stringify(valuetosend));
    }
	function writeToScreen(message) {
		output.innerHTML += '<br>' +message
	}

	window.addEventListener("load", init, false);
</script>
</head>

<body>
<h2>WebSocket Test</h2>
<p>Click the send button to transmit the text to the WebSocket server. The server will echo back the text.</p>
<div id = "left_side" style="float: left;">
    <textarea id="input" cols=48 rows=28 >Sample Text</textarea>
    <br>
    <button onclick="doSend()">Send</button><button onclick="doEcho()">Echo</button>

</div>
<div id="right_side" style="float: left;width:250px;overflow:scroll">
    <div id="output"></div>
</div>
</body>
<script src="https://code.jquery.com/jquery-2.2.0.min.js" ></script>
</html>
